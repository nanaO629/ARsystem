<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AR Navi</title>
</head>
<body style="margin:0px; overflow:hidden;">
  <script src="aframe.min.js"></script>
  <script src="aframe-ar.js"></script>

  <a-scene embedded arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3; debugUIEnabled: false;">
    <script>
      // マーカーを書き出す
      for (let i = 0; i <= 28; i++) {
        document.write(`
          <a-marker type="barcode" value="${i}" id="marker-${i}">
            <a-cone id="arrow${i}-cone" position="0 1 0" radius-bottom="0.4" radius-top="0" height="1.2" color="green"></a-cone>
            <a-cylinder id="arrow${i}-cylinder" position="0 0.7 0" radius="0.12" height="1.6" color="green"></a-cylinder>
          </a-marker>
        `);
      }
    </script>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    function setArrowDirection(markerId, direction) {
      const cone = document.querySelector(`#arrow${markerId}-cone`);
      const cylinder = document.querySelector(`#arrow${markerId}-cylinder`);
      if (!cone || !cylinder) return;

      if (direction === 'right') {
        cone.setAttribute("rotation", "0 0 -90");
        cylinder.setAttribute("rotation", "0 0 90");
        cone.setAttribute("position", "0.7 0 0");
      } else if (direction === 'left') {
        cone.setAttribute("rotation", "0 0 90");
        cylinder.setAttribute("rotation", "0 0 -90");
        cone.setAttribute("position", "-0.7 0 0");
      } else if (direction === 'up') {
        cone.setAttribute("rotation", "0 0 0");
        cylinder.setAttribute("rotation", "0 0 0");
        cone.setAttribute("position", "0 0.7 0");
      } else if (direction === 'down') {
        cone.setAttribute("rotation", "0 180 0");
        cylinder.setAttribute("rotation", "0 180 0");
        cone.setAttribute("position", "0 -0.7 0");
      }
    }

    // DOM構築が終わってから処理する
    window.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const room = urlParams.get('room');

      if (room === '3') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'up');
        setArrowDirection(3, 'up');
        for (let i = 4; i <= 9; i++) setArrowDirection(i, 'left');
      } else if (room === '4') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'up');
        for (let i = 5; i <= 9; i++) setArrowDirection(i, 'left');
      } else if (room === '5') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'up');
        for (let i = 6; i <= 9; i++) setArrowDirection(i, 'left');
      } else if (room === '6') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'right');
        setArrowDirection(6, 'up');
        for (let i = 7; i <= 9; i++) setArrowDirection(i, 'left');
      } else if (room === '7') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'right');
        setArrowDirection(6, 'right');
        setArrowDirection(7, 'up');
        setArrowDirection(8, 'left');
        setArrowDirection(9, 'left');
      } else if (room === '8') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'right');
        setArrowDirection(6, 'up');
        setArrowDirection(7, 'up');
        setArrowDirection(8, 'left');
        setArrowDirection(9, 'left');
      }
    });
  </script>
</body>
</html>
