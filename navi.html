<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ARナビ</title>
  <script src="aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
  <style>
    .label {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 18px;
      display: none;
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <div class="label" id="stairsLabel">階段へ</div>
  
  <a-scene embedded arjs="sourceType: webcam;">
    <!-- カメラ -->
    <a-camera position="0 1.6 0"></a-camera>

    <!-- マーカーごとの表示要素 -->
    <a-assets>
      <img id="arrow-right" src="arrow_right.png" />
      <img id="arrow-left" src="arrow_left.png" />
      <img id="arrow-back" src="arrow_back.png" />
      <img id="arrow-down" src="arrow_down.png" />
      <img id="arrow-straight" src="arrow_straight.png" />
      <img id="arrow-diagonal-left" src="arrow_diagonal_left.png" />
    </a-assets>

    <!-- 11個のマーカーを配置 -->
    <a-marker id="marker1" type="barcode" value="1"></a-marker>
    <a-marker id="marker2" type="barcode" value="2"></a-marker>
    <a-marker id="marker3" type="barcode" value="3"></a-marker>
    <a-marker id="marker4" type="barcode" value="4"></a-marker>
    <a-marker id="marker5" type="barcode" value="5"></a-marker>
    <a-marker id="marker6" type="barcode" value="6"></a-marker>
    <a-marker id="marker7" type="barcode" value="7"></a-marker>
    <a-marker id="marker8" type="barcode" value="8"></a-marker>
    <a-marker id="marker9" type="barcode" value="9"></a-marker>
    <a-marker id="marker10" type="barcode" value="10"></a-marker>
    <a-marker id="marker11" type="barcode" value="11"></a-marker>
  </a-scene>

  <script>
    const stairsLabel = document.getElementById("stairsLabel");
    const destination = sessionStorage.getItem("destination");

    // 講義室ごとのルート情報
    const routes = {
      "講義室3": {1:"右",2:"うしろ",3:"うしろ",4:"左",5:"左",6:"左",7:"左",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室4": {1:"右",2:"右",3:"下",4:"直進",5:"左",6:"左",7:"左",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室5": {1:"右",2:"右",3:"下",4:"右",5:"直進",6:"左",7:"左",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室6": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"直進",7:"ひだり",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室7": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"右",7:"直進",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室8": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"直進",7:"うしろ",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室9": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"階段",7:"右",8:"下",9:"階段",10:"左",11:"左"}
    };

    // 矢印画像をマーカーに表示する関数
    function setArrow(markerId, direction) {
      const marker = document.getElementById(markerId);
      if (!marker) return;

      // 階段の場合 → ラベル表示して矢印は非表示
      if (direction === "階段") {
        stairsLabel.style.display = "block";
        marker.innerHTML = "";
        return;
      }

      stairsLabel.style.display = "none";
      let imgId = "";
      switch(direction) {
        case "右": imgId = "arrow-right"; break;
        case "左": imgId = "arrow-left"; break;
        case "うしろ": imgId = "arrow-back"; break;
        case "下": imgId = "arrow-down"; break;
        case "直進": imgId = "arrow-straight"; break;
        case "左斜め": imgId = "arrow-diagonal-left"; break;
      }
      marker.innerHTML = `<a-image src="#${imgId}" position="0 0 0" rotation="-90 0 0" scale="1 1 1"></a-image>`;
    }

    // 現在の目的地に応じてルート設定
    Object.keys(routes[destination]).forEach(value => {
      setArrow("marker" + value, routes[destination][value]);
    });
  </script>
</body>
</html>
