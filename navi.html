<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AR Navi</title>
</head>
<body style="margin:0px; overflow:hidden;">
  <script src="aframe.min.js"></script>
  <script src="aframe-ar.js"></script>

  <a-scene embedded arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3; debugUIEnabled: false;">
    <!-- 3D矢印モデルをプリロード -->
    <a-assets>
      <!-- arrow.glb はこのHTMLと同じフォルダに置いてください。別パスなら src を変更 -->
      <a-asset-item id="arrowModel" src="arrow.glb"></a-asset-item>
    </a-assets>

    <script>
      // マーカー0〜28を生成。
      for (let i = 0; i <= 28; i++) {
        document.write(`
          <a-marker type="barcode" value="${i}" id="marker-${i}">
            <a-entity id="arrow${i}"
                      gltf-model="#arrowModel"
                      position="0 0 0"
                      rotation="0 0 0"
                      scale="0.8 0.8 0.8"></a-entity>
          </a-marker>
        `);
      }
    </script>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // モデルの基準向きが合わない場合はここを±90ずつ調整
    const BASE_X = 0, BASE_Y = 0, BASE_Z = 0;

    function setArrowDirection(markerId, direction) {
      const arrow = document.querySelector(`#arrow${markerId}`);
      if (!arrow) return;

      // 既存ロジックに合わせ、Z軸回転で左右・前後を表現
      let z = 0;
      if (direction === 'right') z = -90;
      else if (direction === 'left') z = 90;
      else if (direction === 'up') z = 0;
      else if (direction === 'down') z = 180;

      arrow.setAttribute('rotation', `${BASE_X} ${BASE_Y} ${BASE_Z + z}`);
    }

    const urlParams = new URLSearchParams(window.location.search);
    const destination = urlParams.get('destination');

    if (destination === 'class3') {
      setArrowDirection(1, 'right');
      setArrowDirection(2, 'up');
      setArrowDirection(3, 'up');
      for (let i = 4; i <= 9; i++) setArrowDirection(i, 'left');

    } else if (destination === 'class4') {
      setArrowDirection(1, 'right');
      setArrowDirection(2, 'right');
      setArrowDirection(3, 'down');
      setArrowDirection(4, 'up');
      for (let i = 5; i <= 9; i++) setArrowDirection(i, 'left');

    } else if (destination === 'class5') {
      setArrowDirection(1, 'right');
      setArrowDirection(2, 'right');
      setArrowDirection(3, 'down');
      setArrowDirection(4, 'right');
      setArrowDirection(5, 'up');
      for (let i = 6; i <= 9; i++) setArrowDirection(i, 'left');

    } else if (destination === 'class6') {
      setArrowDirection(1, 'right');
      setArrowDirection(2, 'right');
      setArrowDirection(3, 'down');
      setArrowDirection(4, 'right');
      setArrowDirection(5, 'right');
      setArrowDirection(6, 'up');
      for (let i = 7; i <= 9; i++) setArrowDirection(i, 'left');

    } else if (destination === 'class7') {
      setArrowDirection(1, 'right');
      setArrowDirection(2, 'right');
      setArrowDirection(3, 'down');
      setArrowDirection(4, 'right');
      setArrowDirection(5, 'right');
      setArrowDirection(6, 'right');
      setArrowDirection(7, 'up');
      setArrowDirection(8, 'left');
      setArrowDirection(9, 'left');

    } else if (destination === 'class8') {
      setArrowDirection(1, 'right');
      setArrowDirection(2, 'right');
      setArrowDirection(3, 'down');
      setArrowDirection(4, 'right');
      setArrowDirection(5, 'right');
      setArrowDirection(6, 'up');
      setArrowDirection(7, 'up');
      setArrowDirection(8, 'left');
      setArrowDirection(9, 'left');

    } else if (destination === 'pcroom') { // 計算機実習室（indexのリンクと合わせて pcroom）
      setArrowDirection(1, 'right');
      setArrowDirection(2, 'right');
      setArrowDirection(3, 'right'); // ユーザー指示により3は右
      for (let i = 4; i <= 8; i++) setArrowDirection(i, 'right');
      setArrowDirection(9, 'up');     // 9は直進
    }
  </script>
</body>
</html>
