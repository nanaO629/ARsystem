<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ARナビ</title>
  <script src="aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
  <style>
    .label {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 18px;
      display: none;
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <div class="label" id="stairsLabel">階段へ</div>

  <a-scene embedded arjs="sourceType: webcam;">
    <!-- カメラ -->
    <a-camera position="0 1.6 0"></a-camera>

    <!-- GLBモデルの読み込み -->
    <a-assets>
      <a-asset-item id="arrow-model" src="arrow.glb"></a-asset-item>
    </a-assets>

    <!-- マーカー11個 -->
    <a-marker id="marker1" type="barcode" value="1"><a-gltf-model id="arrow1" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker2" type="barcode" value="2"><a-gltf-model id="arrow2" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker3" type="barcode" value="3"><a-gltf-model id="arrow3" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker4" type="barcode" value="4"><a-gltf-model id="arrow4" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker5" type="barcode" value="5"><a-gltf-model id="arrow5" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker6" type="barcode" value="6"><a-gltf-model id="arrow6" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker7" type="barcode" value="7"><a-gltf-model id="arrow7" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker8" type="barcode" value="8"><a-gltf-model id="arrow8" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker9" type="barcode" value="9"><a-gltf-model id="arrow9" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker10" type="barcode" value="10"><a-gltf-model id="arrow10" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
    <a-marker id="marker11" type="barcode" value="11"><a-gltf-model id="arrow11" src="#arrow-model" scale="0.5 0.5 0.5" rotation="0 0 0" visible="false"></a-gltf-model></a-marker>
  </a-scene>

  <script>
    const stairsLabel = document.getElementById("stairsLabel");
    const destination = sessionStorage.getItem("destination");

    // ルート情報
    const routes = {
      "講義室3": {1:"右",2:"うしろ",3:"うしろ",4:"左",5:"左",6:"左",7:"左",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室4": {1:"右",2:"右",3:"下",4:"直進",5:"左",6:"左",7:"左",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室5": {1:"右",2:"右",3:"下",4:"右",5:"直進",6:"左",7:"左",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室6": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"直進",7:"ひだり",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室7": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"右",7:"直進",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室8": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"直進",7:"うしろ",8:"左斜め",9:"左",10:"左",11:"左"},
      "講義室9": {1:"右",2:"右",3:"下",4:"右",5:"右",6:"階段",7:"右",8:"下",9:"階段",10:"左",11:"左"}
    };

    // 矢印の向きをマッピング
    const rotationMap = {
      "右": "0 90 0",
      "左": "0 -90 0",
      "うしろ": "0 180 0",
      "下": "0 180 0",
      "直進": "0 0 0",
      "左斜め": "0 -45 0"
    };

    // 矢印を設定
    Object.keys(routes[destination]).forEach(value => {
      const direction = routes[destination][value];
      const arrow = document.getElementById(`arrow${value}`);

      if (direction === "階段") {
        arrow.setAttribute("visible", false);
        stairsLabel.style.display = "block";
        return;
      }

      stairsLabel.style.display = "none";
      arrow.setAttribute("rotation", rotationMap[direction]);
      arrow.setAttribute("visible", true);
    });
  </script>
</body>
</html>
