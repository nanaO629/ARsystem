<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ARナビゲーション</title>
  <script src="aframe.min.js"></script>
  <script src="aframe-ar.js"></script>
</head>
<body style="margin:0; overflow:hidden;">
  <a-scene embedded arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3; debugUIEnabled: false;">
    <script>
      // 矢印の角度設定
      const rotationMap = {
        "右": "0 90 0",
        "左": "0 -90 0",
        "うしろ": "0 180 0",
        "下": "0 0 0",          // 下向きの時は前方
        "直進": "0 0 0",
        "左斜め": "0 -45 0",
        "右斜め": "0 45 0"
      };

      // 講義室ごとのマーカー→方向設定
      const arrowSettings = {
        3: {
          1: "右", 2: "うしろ", 3: "うしろ",
          4: "左", 5: "左", 6: "左", 7: "左",
          8: "左斜め", 9: "左", 10: "左", 11: "左"
        },
        4: {
          1: "右", 2: "右", 3: "下", 4: "直進",
          5: "左", 6: "左", 7: "左", 8: "左斜め",
          9: "左", 10: "左", 11: "左"
        },
        5: {
          1: "右", 2: "右", 3: "下", 4: "右",
          5: "直進", 6: "左", 7: "左", 8: "左斜め",
          9: "左", 10: "左", 11: "左"
        },
        6: {
          1: "右", 2: "右", 3: "下", 4: "右",
          5: "右", 6: "直進", 7: "左", 8: "左斜め",
          9: "左", 10: "左", 11: "左"
        },
        7: {
          1: "右", 2: "右", 3: "下", 4: "右",
          5: "右", 6: "右", 7: "直進", 8: "左斜め",
          9: "左", 10: "左", 11: "左"
        },
        8: {
          1: "右", 2: "右", 3: "下", 4: "右",
          5: "右", 6: "直進", 7: "うしろ", 8: "左斜め",
          9: "左", 10: "左", 11: "左"
        },
        9: {
          1: "右", 2: "右", 3: "下", 4: "右",
          5: "右", 6: "階段", 7: "右", 8: "下",
          9: "階段", 10: "左", 11: "左"
        }
      };

      // URLから目的地を取得
      const urlParams = new URLSearchParams(window.location.search);
      const room = parseInt(urlParams.get('room')) || 3;

      // マーカー生成
      for (let i = 1; i <= 28; i++) {
        const direction = arrowSettings[room]?.[i];
        const rotation = rotationMap[direction] || "0 0 0";

        document.write(`
          <a-marker type="barcode" value="${i}" id="marker-${i}">
            ${
              direction === "階段"
                ? `<a-text value="階段へ" color="red" position="0 1 0" align="center"></a-text>`
                : `
                  <a-cone id="arrow${i}-cone" position="0 1 0" radius-bottom="0.4" radius-top="0" height="1.2" color="green" rotation="${rotation}"></a-cone>
                  <a-cylinder id="arrow${i}-cylinder" position="0 0.7 0" radius="0.12" height="1.6" color="green" rotation="${rotation}"></a-cylinder>
                `
            }
          </a-marker>
        `);
      }
    </script>
    <a-entity camera></a-entity>
  </a-scene>
</body>
</html>
