<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AR Navi</title>
</head>
<body style="margin:0px; overflow:hidden;">
  <script src="aframe.min.js"></script>
  <script src="aframe-ar.js"></script>

  <a-scene embedded arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3; debugUIEnabled: false;">
    <script>
      // マーカーを自動生成
      for (let i = 0; i <= 28; i++) {
        document.write(`
          <a-marker type="barcode" value="${i}" id="marker-${i}">
            <a-entity id="arrow${i}" rotation="0 0 0">
              <a-cone position="0 0.6 0" radius-bottom="0.4" radius-top="0" height="1.2" color="green"></a-cone>
              <a-cylinder position="0 0 0" radius="0.12" height="1.2" color="green"></a-cylinder>
            </a-entity>
            <a-text id="text${i}" value="" color="red" position="0 1.5 0" align="center" side="double" visible="false"></a-text>
          </a-marker>
        `);
      }
    </script>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    function setArrowDirection(markerId, direction) {
      const arrow = document.querySelector(`#arrow${markerId}`);
      const text = document.querySelector(`#text${markerId}`);
      if (!arrow || !text) return;

      // 階段の場合
      if (direction === 'stairs') {
        arrow.setAttribute("visible", "false");
        text.setAttribute("value", "階段へ");
        text.setAttribute("visible", "true");
        return;
      }

      // 矢印を表示してテキストを隠す
      arrow.setAttribute("visible", "true");
      text.setAttribute("visible", "false");

      // 回転の指定
      if (direction === 'right') {
        arrow.setAttribute("rotation", "0 -90 0");
      } else if (direction === 'left') {
        arrow.setAttribute("rotation", "0 90 0");
      } else if (direction === 'up') {
        arrow.setAttribute("rotation", "0 0 0");
      } else if (direction === 'down') {
        arrow.setAttribute("rotation", "0 180 0");
      } else if (direction === 'upleft') {
        arrow.setAttribute("rotation", "0 45 0");
      }
    }

    // ページ読み込み後に目的地に応じたルートを設定
    window.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const room = urlParams.get('room');

      if (room === '3') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'down');
        setArrowDirection(3, 'down');
        for (let i = 4; i <= 7; i++) setArrowDirection(i, 'left');
        setArrowDirection(8, 'upleft');
        for (let i = 9; i <= 11; i++) setArrowDirection(i, 'left');
      } else if (room === '4') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'up');
        for (let i = 5; i <= 7; i++) setArrowDirection(i, 'left');
        setArrowDirection(8, 'upleft');
        for (let i = 9; i <= 11; i++) setArrowDirection(i, 'left');
      } else if (room === '5') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'up');
        for (let i = 6; i <= 7; i++) setArrowDirection(i, 'left');
        setArrowDirection(8, 'upleft');
        for (let i = 9; i <= 11; i++) setArrowDirection(i, 'left');
      } else if (room === '6') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'right');
        setArrowDirection(6, 'up');
        setArrowDirection(7, 'left');
        setArrowDirection(8, 'upleft');
        for (let i = 9; i <= 11; i++) setArrowDirection(i, 'left');
      } else if (room === '7') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'right');
        setArrowDirection(6, 'right');
        setArrowDirection(7, 'up');
        setArrowDirection(8, 'upleft');
        for (let i = 9; i <= 11; i++) setArrowDirection(i, 'left');
      } else if (room === '8') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'right');
        setArrowDirection(6, 'up');
        setArrowDirection(7, 'down');
        setArrowDirection(8, 'upleft');
        for (let i = 9; i <= 11; i++) setArrowDirection(i, 'left');
      } else if (room === '9') {
        setArrowDirection(1, 'right');
        setArrowDirection(2, 'right');
        setArrowDirection(3, 'down');
        setArrowDirection(4, 'right');
        setArrowDirection(5, 'right');
        setArrowDirection(6, 'stairs');
        setArrowDirection(7, 'right');
        setArrowDirection(8, 'down');
        setArrowDirection(9, 'stairs');
        setArrowDirection(10, 'left');
        setArrowDirection(11, 'left');
      }
    });
  </script>
</body>
</html>
